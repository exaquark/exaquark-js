<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: exaquark.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: exaquark.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { log, getRequest } from './helpers/private.js'
const WebSocket = require('websocket').w3cwebsocket

/**
 * Represents an exaQuark instance
 * @constructor
 * @param {string} entryPoint - The URL of your exaQuark universe.
 * @param {string} apiKey - Your authentication key
 * @param {Object} options - @TODO
 */
export default class exaQuark {
  constructor(entryPoint, apiKey, options = {}){
    this.transport = WebSocket
    this.logger = options.logger || function(){} // noop
    this.params = options.params || {}
    this.entryPoint = `${entryPoint}`
    this.bindings = []
  }


  /**
   * Initializes the websocket connection to exaquark
   */
  connect() {
    getRequest(this.entryPoint)
    .then(response => {
      console.log('response', response)
    }, reject => {
      console.log('reject', reject)
      // this.conn = new this.transport(resp)
      // this.conn.onopen = () => this.onConnOpen()
      // this.conn.onerror   = error => this.onConnError(error)
      // this.conn.onmessage = event => this.onConnMessage(event)
      // this.conn.onclose   = event => this.onConnClose(event)
    })
  }

  /**
   * Disconnects from exaquark
   */
  disconnect(callback, code, reason) {

  }

  /**
   * Bind an event to the socket.
   * @example
   * exaQuark.on("neighbors", msg => console.log("Got list of neighbors", msg) )
   * @example
   * exaQuark.on("updates", msg => console.log("Got updates from neighbors", msg) )
   * @example
   * exaQuark.on("removes", msg => console.log("Got list of neighbors to who have left", msg) )
   */
  on (event, callback) {
    this.bindings.push({event, callback})
  }

  /**
   * Disconnect a binding
   * @example
   * exaQuark.off("neighbors")
   */
  off(event){
    this.bindings = this.bindings.filter( bind => bind.event !== event )
  }

  /**
   * Push an update
   * @example
   * exaQuark.off("neighbors")
   */
  push(event, payload){
    if(!this.joinedOnce) throw(`tried to push '${event}' to '${this.topic}' before joining. Use channel.join() before pushing events`)
    let pushEvent = new Push(this, event, payload)
    if(this.canPush()){
      pushEvent.send()
    } else {
      this.pushBuffer.push(pushEvent)
    }
    return pushEvent
  }

  onConnOpen(){
    this.log("transport", `connected to ${this.endPoint}`, this.transport.prototype)
  }

  onConnError(error){
    this.log("transport", error)
  }

  onConnClose(event){
    this.log("transport", "close", event)
  }

  ontimeout(){
    this.onerror("timeout")
    // this.closeAndRetry()
  }

  onConnMessage(rawMessage) {
    let msg = JSON.parse(rawMessage.data)
    let {topic, event, payload, ref} = msg
    this.bindings
      .filter(bind => bind.event === triggerEvent)
      .map( bind => bind.callback(payload, ref) )
  }

  canPush() {
    return this.socket.isConnected() &amp;&amp; this.state === CHANNEL_STATES.joined
  }

  // onNeighborsMessage (payload) {
  //   console.log('payload', payload)
  // }
  //
  // onUpdatesMessage (payload) {
  //   console.log('payload', payload)
  // }
  //
  // onRemovesMessage (payload) {
  //   console.log('payload', payload)
  // }


}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module.exports.html">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#connect">connect</a></li><li><a href="global.html#disconnect">disconnect</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#push">push</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Jan 30 2018 17:01:37 GMT+0800 (+08)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
